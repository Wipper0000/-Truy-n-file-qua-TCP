
<h2 align="center">
    <a href="https://dainam.edu.vn/vi/khoa-cong-nghe-thong-tin">
    üéì Faculty of Information Technology (DaiNam University)
    </a>
</h2>
<h2 align="center">
   TRUY·ªÄN FILE QUA GIAO TH·ª®C TCP
</h2>
<div align="center">
    <p align="center">
        <img src="docs/aiotlab_logo.png" alt="AIoTLab Logo" width="170"/>
        <img src="docs/fitdnu_logo.png" alt="AIoTLab Logo" width="180"/>
        <img src="docs/dnu_logo.png" alt="DaiNam University Logo" width="200"/>
    </p>

[![AIoTLab](https://img.shields.io/badge/AIoTLab-green?style=for-the-badge)](https://www.facebook.com/DNUAIoTLab)
[![Faculty of Information Technology](https://img.shields.io/badge/Faculty%20of%20Information%20Technology-blue?style=for-the-badge)](https://dainam.edu.vn/vi/khoa-cong-nghe-thong-tin)
[![DaiNam University](https://img.shields.io/badge/DaiNam%20University-orange?style=for-the-badge)](https://dainam.edu.vn)

</div>

## üìñ 1. Gi·ªõi thi·ªáu
Trong th·ªùi ƒë·∫°i c√¥ng ngh·ªá th√¥ng tin ph√°t tri·ªÉn m·∫°nh m·∫Ω, nhu c·∫ßu trao ƒë·ªïi v√† chia s·∫ª d·ªØ li·ªáu gi·ªØa c√°c m√°y t√≠nh ng√†y c√†ng ph·ªï bi·∫øn. M·ªôt trong nh·ªØng ph∆∞∆°ng th·ª©c quan tr·ªçng v√† ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i l√† truy·ªÅn file qua giao th·ª©c TCP (Transmission Control Protocol).

TCP l√† giao th·ª©c h∆∞·ªõng k·∫øt n·ªëi, ƒë·∫£m b·∫£o t√≠nh tin c·∫≠y, to√†n v·∫πn v√† ƒë√∫ng th·ª© t·ª± d·ªØ li·ªáu trong qu√° tr√¨nh truy·ªÅn. Nh·ªù ƒë√≥, vi·ªác truy·ªÅn file qua TCP c√≥ th·ªÉ √°p d·ª•ng cho nhi·ªÅu h·ªá th·ªëng th·ª±c t·∫ø nh∆∞: d·ªãch v·ª• FTP, ·ª©ng d·ª•ng chat, h·ªá th·ªëng l∆∞u tr·ªØ d·ªØ li·ªáu ph√¢n t√°n, hay c√°c ph·∫ßn m·ªÅm h·ªó tr·ª£ t·∫£i xu·ªëng.

üîë **C√°c ch·ª©c nƒÉng ch√≠nh c·ªßa h·ªá th·ªëng**:

-K·∫øt n·ªëi Client ‚Äì Server qua TCP Socket.

-Truy·ªÅn v√† nh·∫≠n file gi·ªØa c√°c client.

-Hi·ªÉn th·ªã ti·∫øn tr√¨nh truy·ªÅn v√† nh·∫≠n file .

-L∆∞u file t·ª± ƒë·ªông v√†o th∆∞ m·ª•c ch·ªâ ƒë·ªãnh.

## üõ†Ô∏è 2. C√¥ng ngh·ªá s·ª≠ d·ª•ng

**Ng√¥n ng·ªØ l·∫≠p tr√¨nh**: Java

**Giao th·ª©c**: TCP,TCP Socket

**C√¥ng ngh·ªá giao di·ªán**: Java Swing

**Th∆∞ vi·ªán**:

-java.net 

-java.io 

**C√¥ng c·ª• ph√°t tri·ªÉn**: Eclipse IDE

**H·ªá ƒëi·ªÅu h√†nh**: Windows 11

**JDK**: Java SE


## üöÄ 3. H√¨nh ·∫£nh c√°c ch·ª©c nƒÉng


<p align="center">
  <img src="docs/·∫¢nh 1.png" alt="·∫¢nh 1" width="500"/>
</p>
<p align="center">
  <em>H√¨nh 1: Giao di·ªán nh·∫≠p t√™n user </em>
</p>


<p align="center">
  <img src="docs/·∫¢nh 3.png" alt="·∫¢nh 3" width="500"/>
</p>
<p align="center">
  <em>H√¨nh 2: Giao di·ªán ch·ªçn file ƒë·ªÉ g·ª≠i </em>
</p>


<p align="center">
  <img src="docs/·∫¢nh 4.png" alt="·∫¢nh 4" width="500"/>
</p>
<p align="center">
  <em>H√¨nh 3: Giao di·ªán Client sau khi ch·ªçn  </em>
</p>


<p align="center">
  <img src="docs/·∫¢nh 5.png" alt="·∫¢nh 5" width="500"/>
</p>
<p align="center">
  <em>H√¨nh 4: Giao di·ªán Khi File g·ª≠i th√†nh c√¥ng  </em>
</p>


<p align="center">
  <img src="docs/·∫¢nh 6.png" alt="·∫¢nh 6" width="500"/>
</p>
<p align="center">
  <em>H√¨nh 5: Giao di·ªán Client user kh√°c truy c·∫≠p server sau khi user 1 chuy·ªÉn file</em>
</p>

## üìù 4. C√°c b∆∞·ªõc c√†i ƒë·∫∑t

#### B∆∞·ªõc 1: Chu·∫©n b·ªã m√¥i tr∆∞·ªùng
1. **Ki·ªÉm tra Java**: M·ªü terminal/command prompt v√† ch·∫°y:
   ```bash
   java -version
   javac -version
   ```
   ƒê·∫£m b·∫£o c·∫£ hai l·ªánh ƒë·ªÅu hi·ªÉn th·ªã phi√™n b·∫£n Java 8 tr·ªü l√™n.

2. **T·∫£i m√£ ngu·ªìn**: Sao ch√©p th∆∞ m·ª•c `Truyen-file-qua-tcp` ch·ª©a c√°c file:
   - `FileServer.java`
   - `ChatClient.java`

#### B∆∞·ªõc 2: Bi√™n d·ªãch m√£ ngu·ªìn
1.Ch·∫°y server:
```bash
java component.FileServer
```

2.Ch·∫°y Client:
```bash
java component.ChatClient
```
<p></p>

#### Source Code 

1. FileServer.java:
```package component;

import java.io.*;
import java.net.*;
import java.util.*;

public class FileServer {
    private static final int PORT = 12345;
    private static Set<ClientHandler> clients = Collections.synchronizedSet(new HashSet<>());

    public static void main(String[] args) {
        try (ServerSocket serverSocket = new ServerSocket(PORT)) {
            System.out.println("‚úÖ FileServer ch·∫°y t·∫°i port " + PORT);

            while (true) {
                Socket socket = serverSocket.accept();
                ClientHandler clientHandler = new ClientHandler(socket);
                clients.add(clientHandler);
                new Thread(clientHandler).start();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // G·ª≠i file t·ªõi t·∫•t c·∫£ client kh√°c
    public static void broadcastFile(String sender, String fileName, byte[] fileData, ClientHandler self) {
        synchronized (clients) {
            for (ClientHandler client : clients) {
                if (client != self) {
                    client.sendFile(sender, fileName, fileData);
                }
            }
        }
    }

    // Class x·ª≠ l√Ω client
    static class ClientHandler implements Runnable {
        private Socket socket;
        private DataInputStream dis;
        private DataOutputStream dos;
        private String username;

        public ClientHandler(Socket socket) {
            try {
                this.socket = socket;
                this.dis = new DataInputStream(socket.getInputStream());
                this.dos = new DataOutputStream(socket.getOutputStream());
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

        public void run() {
            try {
                // Nh·∫≠n username t·ª´ client
                username = dis.readUTF();
                System.out.println("üë§ " + username + " ƒë√£ k·∫øt n·ªëi: " + socket.getInetAddress());

                while (true) {
                    String fileName = dis.readUTF();
                    long fileSize = dis.readLong();

                    File dir = new File("server_files");
                    if (!dir.exists()) dir.mkdir();

                    File file = new File(dir, fileName);
                    FileOutputStream fos = new FileOutputStream(file);

                    byte[] buffer = new byte[4096];
                    long remaining = fileSize;
                    int bytesRead;
                    ByteArrayOutputStream baos = new ByteArrayOutputStream();

                    while (remaining > 0 &&
                           (bytesRead = dis.read(buffer, 0, (int) Math.min(buffer.length, remaining))) != -1) {
                        fos.write(buffer, 0, bytesRead);
                        baos.write(buffer, 0, bytesRead);
                        remaining -= bytesRead;
                    }
                    fos.close();

                    System.out.println("üì• " + username + " g·ª≠i file: " + fileName);

                    // G·ª≠i t·ªõi c√°c client kh√°c
                    FileServer.broadcastFile(username, fileName, baos.toByteArray(), this);
                }
            } catch (IOException e) {
                System.out.println("‚ùå M·∫•t k·∫øt n·ªëi v·ªõi " + username);
            } finally {
                try { socket.close(); } catch (IOException ignored) {}
                clients.remove(this);
            }
        }

        public void sendFile(String sender, String fileName, byte[] fileData) {
            try {
                dos.writeUTF(sender);
                dos.writeUTF(fileName);
                dos.writeLong(fileData.length);
                dos.write(fileData);
                dos.flush();
            } catch (IOException e) {
                System.out.println("‚ö†Ô∏è L·ªói g·ª≠i file t·ªõi " + username);
            }
        }
    }
}
```

2. ChatClient.java:
```
package component;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.awt.event.*;
import java.io.*;
import java.net.Socket;

public class ChatClient extends JFrame {
    private JButton chooseButton, sendButton;
    private JLabel selectedFileLabel;
    private DefaultListModel<String> chatModel;
    private JList<String> chatList;
    private File selectedFile;
    private Socket socket;
    private DataOutputStream dos;
    private DataInputStream dis;
    private String username;

    public ChatClient(String serverAddress, int port, String username) {
        this.username = username;

        setTitle("File Chat - " + username);
        setSize(500, 400);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        JPanel panel = new JPanel(new BorderLayout());
        panel.setBackground(new Color(245, 245, 255));
        panel.setBorder(new EmptyBorder(10, 10, 10, 10));

        // Danh s√°ch "chat" (file g·ª≠i/nh·∫≠n)
        chatModel = new DefaultListModel<>();
        chatList = new JList<>(chatModel);
        JScrollPane scrollPane = new JScrollPane(chatList);
        scrollPane.setBorder(BorderFactory.createTitledBorder("üí¨ L·ªãch s·ª≠ g·ª≠i file"));

        // Panel n√∫t
        JPanel bottomPanel = new JPanel();
        bottomPanel.setBackground(new Color(230, 230, 250));
        chooseButton = new JButton("üìÇ Ch·ªçn file");
        sendButton = new JButton("üì§ G·ª≠i");
        sendButton.setEnabled(false);

        // Label hi·ªÉn th·ªã file ƒë√£ ch·ªçn
        selectedFileLabel = new JLabel("Ch∆∞a ch·ªçn file n√†o");
        selectedFileLabel.setForeground(Color.DARK_GRAY);

        bottomPanel.add(chooseButton);
        bottomPanel.add(sendButton);
        bottomPanel.add(selectedFileLabel);

        panel.add(scrollPane, BorderLayout.CENTER);
        panel.add(bottomPanel, BorderLayout.SOUTH);
        add(panel);

        // Ch·ªçn file
        chooseButton.addActionListener(e -> {
            JFileChooser fileChooser = new JFileChooser();
            if (fileChooser.showOpenDialog(this) == JFileChooser.APPROVE_OPTION) {
                selectedFile = fileChooser.getSelectedFile();
                selectedFileLabel.setText("ƒê√£ ch·ªçn: " + selectedFile.getName());
                sendButton.setEnabled(true);
            }
        });

        // G·ª≠i file
        sendButton.addActionListener(e -> {
            if (selectedFile != null) {
                sendFile(selectedFile);
                chatModel.addElement("B·∫°n: " + selectedFile.getName());
                selectedFileLabel.setText("Ch∆∞a ch·ªçn file n√†o"); // reset sau khi g·ª≠i
                sendButton.setEnabled(false);
            }
        });

        // Click m·ªü file
        chatList.addMouseListener(new MouseAdapter() {
            public void mouseClicked(MouseEvent evt) {
                if (evt.getClickCount() == 2) {
                    String item = chatList.getSelectedValue();
                    if (item != null && item.contains(": ")) {
                        String fileName = item.substring(item.indexOf(": ") + 2);
                        try {
                            Desktop.getDesktop().open(new File("received/" + fileName));
                        } catch (Exception ex) {
                            JOptionPane.showMessageDialog(null, "Kh√¥ng m·ªü ƒë∆∞·ª£c file!");
                        }
                    }
                }
            }
        });

        // K·∫øt n·ªëi server
        try {
            socket = new Socket(serverAddress, port);
            dos = new DataOutputStream(socket.getOutputStream());
            dis = new DataInputStream(socket.getInputStream());

            // G·ª≠i username l√™n server
            dos.writeUTF(username);

            // Thread nh·∫≠n file
            new Thread(() -> {
                try {
                    while (true) {
                        String sender = dis.readUTF();
                        String fileName = dis.readUTF();
                        long fileSize = dis.readLong();

                        File dir = new File("received");
                        if (!dir.exists()) dir.mkdir();

                        File file = new File(dir, fileName);
                        FileOutputStream fos = new FileOutputStream(file);

                        byte[] buffer = new byte[4096];
                        long remaining = fileSize;
                        int bytesRead;
                        while (remaining > 0 &&
                               (bytesRead = dis.read(buffer, 0, (int)Math.min(buffer.length, remaining))) != -1) {
                            fos.write(buffer, 0, bytesRead);
                            remaining -= bytesRead;
                        }
                        fos.close();

                        chatModel.addElement(sender + ": " + fileName);
                    }
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }).start();

        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi server!");
            System.exit(1);
        }
    }

    private void sendFile(File file) {
        try {
            dos.writeUTF(file.getName());
            dos.writeLong(file.length());

            FileInputStream fis = new FileInputStream(file);
            byte[] buffer = new byte[4096];
            int bytesRead;
            while ((bytesRead = fis.read(buffer)) != -1) {
                dos.write(buffer, 0, bytesRead);
            }
            fis.close();
        } catch (IOException e) {
            JOptionPane.showMessageDialog(this, "‚ö†Ô∏è L·ªói g·ª≠i file!");
        }
    }

    public static void main(String[] args) {
        String username = JOptionPane.showInputDialog("Nh·∫≠p t√™n c·ªßa b·∫°n:");
        if (username == null || username.trim().isEmpty()) {
            System.exit(0);
        }
        SwingUtilities.invokeLater(() -> {
            new ChatClient("127.0.0.1", 12345, username).setVisible(true);
        });
    }
}
```
### üöÄ S·ª≠ d·ª•ng ·ª©ng d·ª•ng

1. **K·∫øt n·ªëi server**: ch·∫°y Server.java ƒë·ªÉ l·∫Øng nghe tr√™n port (v√≠ d·ª• 5001).
2. **K·∫øt n·ªëi Client**: ch·∫°y Client.java v√† nh·∫≠p IP, port server ƒë·ªÉ k·∫øt n·ªëi.
3. **Ch·ªçn File**: client ch·ªçn file c·∫ßn g·ª≠i t·ª´ m√°y t√≠nh.
4. **G·ª≠i File**: client g·ª≠i file qua socket TCP t·ªõi server.
5. **Nh·∫≠n File**: server nh·∫≠n d·ªØ li·ªáu v√† ghi file v√†o th∆∞ m·ª•c ƒë√≠ch.
6. **L∆∞u File**: file ƒë∆∞·ª£c l∆∞u t·ª± ƒë·ªông trong th∆∞ m·ª•c m·∫∑c ƒë·ªãnh c·ªßa server.
7. **Ng·∫Øt k·∫øt n·ªëi**:client tho√°t ·ª©ng d·ª•ng ho·∫∑c nh·∫•n Ctrl+C ƒë·ªÉ d·ª´ng.

¬© 2025 AIoTLab, Faculty of Information Technology, DaiNam University. All rights reserved.

---
